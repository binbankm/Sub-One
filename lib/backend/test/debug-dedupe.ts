import { SubscriptionParser } from '../subscription-parser';

const testUrls = `vmess://eyJ2IjoiMiIsInBzIjoi5Yip5L2Z5rWB6YeP77yaMjIyLjkxIEdCIiwiYWRkIjoidXMuamllZGlhbi5zdHJlYW0iLCJwb3J0Ijo0NDMsImlkIjoiMDkyNTI2Y2ItNGU1YS00ODNhLWFkNDYtZTg1YzJhZDkzOTQ4IiwiYWlkIjowLCJzY3kiOiJhdXRvIiwibmV0IjoidGNwIiwidHlwZSI6Im5vbmUiLCJ0bHMiOiJ0bHMiLCJzbmkiOiJndy5hbGljZG4uY29tIiwiYWxsb3dJbnNlY3VyZSI6dHJ1ZX0=
vmess://eyJ2IjoiMiIsInBzIjoi6Led56a75LiL5qyh6YeN572u5Ymp5L2Z77yaMTMg5aSpIiwiYWRkIjoidXMuamllZGlhbi5zdHJlYW0iLCJwb3J0Ijo0NDMsImlkIjoiMDkyNTI2Y2ItNGU1YS00ODNhLWFkNDYtZTg1YzJhZDkzOTQ4IiwiYWlkIjowLCJzY3kiOiJhdXRvIiwibmV0IjoidGNwIiwidHlwZSI6Im5vbmUiLCJ0bHMiOiJ0bHMiLCJzbmkiOiJndy5hbGljZG4uY29tIiwiYWxsb3dJbnNlY3VyZSI6dHJ1ZX0=
vmess://eyJ2IjoiMiIsInBzIjoi5aWX6aSQ5Yiw5pyf77yaMjAyNi0wOS0xNiIsImFkZCI6InVzLmppZWRpYW4uc3RyZWFtIiwicG9ydCI6NDQzLCJpZCI6IjA5MjUyNmNiLTRlNWEtNDgzYS1hZDQ2LWU4NWMyYWQ5Mzk0OCIsImFpZCI6MCwic2N5IjoiYXV0byIsIm5ldCI6InRjcCIsInR5cGUiOiJub25lIiwidGxzIjoidGxzIiwic25pIjoiZ3cuYWxpY2RuLmNvbSIsImFsbG93SW5zZWN1cmUiOnRydWV9
vmess://eyJ2IjoiMiIsInBzIjoi8J+qpyDkuI3lj6/nlKjor7fova/ku7blhoXmm7TmlrDorqLpmIXmiJblrpjnvZHnnIvpl67popjmjpLmn6UiLCJhZGQiOiJ1cy5qaWVkaWFuLnN0cmVhbSIsInBvcnQiOjQ0MywiaWQiOiIwOTI1MjZjYi00ZTVhLTQ4M2EtYWQ0Ni1lODVjMmFkOTM5NDgiLCJhaWQiOjAsInNjeSI6ImF1dG8iLCJuZXQiOiJ0Y3AiLCJ0eXBlIjoibm9uZSIsInRscyI6InRscyIsInNuaSI6Imd3LmFsaWNkbi5jb20iLCJhbGxvd0luc2VjdXJlIjp0cnVlfQ==
vmess://eyJ2IjoiMiIsInBzIjoi8J+HrfCfh7Ag6aaZ5rivMSAo56e75YqoPuiBlOmAmj7nlLXkv6EpIiwiYWRkIjoiaGsxLmppZWRpYW4uc3RyZWFtIiwicG9ydCI6ODQ0MywiaWQiOiIwOTI1MjZjYi00ZTVhLTQ4M2EtYWQ0Ni1lODVjMmFkOTM5NDgiLCJhaWQiOjAsInNjeSI6ImF1dG8iLCJuZXQiOiJ0Y3AiLCJ0eXBlIjoibm9uZSIsInRscyI6InRscyIsInNuaSI6Imd3LmFsaWNkbi5jb20iLCJhbGxvd0luc2VjdXJlIjp0cnVlfQ==
vmess://eyJ2IjoiMiIsInBzIjoi8J+Hr/Cfh7Ug5pel5pysMSAo56e75YqoPueUteS/oT7ogZTpgJopIiwiYWRkIjoianAxLmNuZG5zLnN0cmVhbSIsInBvcnQiOjQ0MywiaWQiOiIwOTI1MjZjYi00ZTVhLTQ4M2EtYWQ0Ni1lODVjMmFkOTM5NDgiLCJhaWQiOjAsInNjeSI6ImF1dG8iLCJuZXQiOiJ0Y3AiLCJ0eXBlIjoibm9uZSIsInRscyI6InRscyIsInNuaSI6Imd3LmFsaWNkbi5jb20iLCJhbGxvd0luc2VjdXJlIjp0cnVlfQ==
vmess://eyJ2IjoiMiIsInBzIjoi8J+Hr/Cfh7Ug5pel5pysMiAo56e75YqoPueUteS/oT7ogZTpgJopIiwiYWRkIjoianAyLmNuZG5zLnN0cmVhbSIsInBvcnQiOjQ0MywiaWQiOiIwOTI1MjZjYi00ZTVhLTQ4M2EtYWQ0Ni1lODVjMmFkOTM5NDgiLCJhaWQiOjAsInNjeSI6ImF1dG8iLCJuZXQiOiJ0Y3AiLCJ0eXBlIjoibm9uZSIsInRscyI6InRscyIsInNuaSI6Imd3LmFsaWNkbi5jb20iLCJhbGxvd0luc2VjdXJlIjp0cnVlfQ==
vmess://eyJ2IjoiMiIsInBzIjoi8J+HsPCfh7cg6Z+p5Zu9ICjnp7vliqg+6IGU6YCaPueUteS/oSkiLCJhZGQiOiJrci5qaWVkaWFuLnN0cmVhbSIsInBvcnQiOjQ0MywiaWQiOiIwOTI1MjZjYi00ZTVhLTQ4M2EtYWQ0Ni1lODVjMmFkOTM5NDgiLCJhaWQiOjAsInNjeSI6ImF1dG8iLCJuZXQiOiJ0Y3AiLCJ0eXBlIjoibm9uZSIsInRscyI6InRscyIsInNuaSI6Imd3LmFsaWNkbi5jb20iLCJhbGxvd0luc2VjdXJlIjp0cnVlfQ==
vmess://eyJ2IjoiMiIsInBzIjoi8J+HuPCfh6wg5paw5Yqg5Z2hMSAo5LiJ572RKSIsImFkZCI6InNnMS5qaWVkaWFuLnN0cmVhbSIsInBvcnQiOjQ0MywiaWQiOiIwOTI1MjZjYi00ZTVhLTQ4M2EtYWQ0Ni1lODVjMmFkOTM5NDgiLCJhaWQiOjAsInNjeSI6ImF1dG8iLCJuZXQiOiJ0Y3AiLCJ0eXBlIjoibm9uZSIsInRscyI6InRscyIsInNuaSI6Imd3LmFsaWNkbi5jb20iLCJhbGxvd0luc2VjdXJlIjp0cnVlfQ==
vmess://eyJ2IjoiMiIsInBzIjoi8J+HuPCfh6wg5paw5Yqg5Z2hMiAo56e75Yqo6IGU6YCaPueUteS/oSkiLCJhZGQiOiJzZzIuamllZGlhbi5zdHJlYW0iLCJwb3J0Ijo0NDMsImlkIjoiMDkyNTI2Y2ItNGU1YS00ODNhLWFkNDYtZTg1YzJhZDkzOTQ4IiwiYWlkIjowLCJzY3kiOiJhdXRvIiwibmV0IjoidGNwIiwidHlwZSI6Im5vbmUiLCJ0bHMiOiJ0bHMiLCJzbmkiOiJndy5hbGljZG4uY29tIiwiYWxsb3dJbnNlY3VyZSI6dHJ1ZX0=
vmess://eyJ2IjoiMiIsInBzIjoi8J+HuvCfh7gg576O5Zu9MSIsImFkZCI6InVzMS5qaWVkaWFuLnN0cmVhbSIsInBvcnQiOjQ0MywiaWQiOiIwOTI1MjZjYi00ZTVhLTQ4M2EtYWQ0Ni1lODVjMmFkOTM5NDgiLCJhaWQiOjAsInNjeSI6ImF1dG8iLCJuZXQiOiJ0Y3AiLCJ0eXBlIjoibm9uZSIsInRscyI6InRscyIsInNuaSI6Imd3LmFsaWNkbi5jb20iLCJhbGxvd0luc2VjdXJlIjp0cnVlfQ==
vmess://eyJ2IjoiMiIsInBzIjoi8J+HuvCfh7gg576O5Zu9MiIsImFkZCI6InVzMi5qaWVkaWFuLnN0cmVhbSIsInBvcnQiOjQ0MywiaWQiOiIwOTI1MjZjYi00ZTVhLTQ4M2EtYWQ0Ni1lODVjMmFkOTk0OCIsImFpZCI6MCwic2N5IjoiYXV0byIsIm5ldCI6InRjcCIsInR5cGUiOiJub25lIiwidGxzIjoidGxzIiwic25pIjoiZ3cuYWxpY2RuLmNvbSIsImFsbG93SW5zZWN1cmUiOnRydWV9
vmess://eyJ2IjoiMiIsInBzIjoi8J+HuvCfh7gg576O5Zu9MyIsImFkZCI6InVzMy5qaWVkaWFuLnN0cmVhbSIsInBvcnQiOjQ0MywiaWQiOiIwOTI1MjZjYi00ZTVhLTQ4M2EtYWQ0Ni1lODVjMmFkOTM5NDgiLCJhaWQiOjAsInNjeSI6ImF1dG8iLCJuZXQiOiJ0Y3AiLCJ0eXBlIjoibm9uZSIsInRscyI6InRscyIsInNuaSI6Imd3LmFsaWNkbi5jb20iLCJhbGxvd0luc2VjdXJlIjp0cnVlfQ==
vmess://eyJ2IjoiMiIsInBzIjoi8J+HqPCfh6Yg5Yqg5ou/5aSnIiwiYWRkIjoiY2EuamllZGlhbi5zdHJlYW0iLCJwb3J0Ijo0NDMsImlkIjoiMDkyNTI2Y2ItNGU1YS00ODNhLWFkNDYtZTg1YzJhZDkzOTQ4IiwiYWlkIjowLCJzY3kiOiJhdXRvIiwibmV0IjoidGNwIiwidHlwZSI6Im5vbmUiLCJ0bHMiOiJ0bHMiLCJzbmkiOiJndy5hbGljZG4uY29tIiwiYWxsb3dJbnNlY3VyZSI6dHJ1ZX0=
vmess://eyJ2IjoiMiIsInBzIjoi8J+HqfCfh6og5b635Zu9MSIsImFkZCI6Ijg1LjIzNC42OS41MiIsInBvcnQiOjQ0MywiaWQiOiIwOTI1MjZjYi00ZTVhLTQ4M2EtYWQ0Ni1lODVjMmFkOTM5NDgiLCJhaWQiOjAsInNjeSI6ImF1dG8iLCJuZXQiOiJ0Y3AiLCJ0eXBlIjoibm9uZSIsInRscyI6InRscyIsInNuaSI6Imd3LmFsaWNkbi5jb20iLCJhbGxvd0luc2VjdXJlIjp0cnVlfQ==
vmess://eyJ2IjoiMiIsInBzIjoi8J+HqfCfh6og5b635Zu9MiIsImFkZCI6ImRlMi5qaWVkaWFuLnN0cmVhbSIsInBvcnQiOjQ0MywiaWQiOiIwOTI1MjZjYi00ZTVhLTQ4M2EtYWQ0Ni1lODVjMmFkOTM5NDgiLCJhaWQiOjAsInNjeSI6ImF1dG8iLCJuZXQiOiJ0Y3AiLCJ0eXBlIjoibm9uZSIsInRscyI6InRscyIsInNuaSI6Imd3LmFsaWNkbi5jb20iLCJhbGxvd0luc2VjdXJlIjp0cnVlfQ==
vmess://eyJ2IjoiMiIsInBzIjoi8J+HufCfh7wg5Y+w5rm+IiwiYWRkIjoidHcxLmppZWRpYW4uc3RyZWFtIiwicG9ydCI6NDQzLCJpZCI6IjA5MjUyNmNiLTRlNWEtNDgzYS1hZDQ2LWU4NWMyYWQ5Mzk0OCIsImFpZCI6MCwic2N5IjoiYXV0byIsIm5ldCI6InRjcCIsInR5cGUiOiJub25lIiwidGxzIjoidGxzIiwic25pIjoiZ3cuYWxpY2RuLmNvbSIsImFsbG93SW5zZWN1cmUiOnRydWV9
vmess://eyJ2IjoiMiIsInBzIjoi8J+HufCfh7cg5Zyf6ICz5YW2IiwiYWRkIjoidHIuamllZGlhbi5zdHJlYW0iLCJwb3J0Ijo0NDMsImlkIjoiMDkyNTI2Y2ItNGU1YS00ODNhLWFkNDYtZTg1YzJhZDkzOTQ4IiwiYWlkIjowLCJzY3kiOiJhdXRvIiwibmV0IjoidGNwIiwidHlwZSI6Im5vbmUiLCJ0bHMiOiJ0bHMiLCJzbmkiOiJndy5hbGljZG4uY29tIiwiYWxsb3dJbnNlY3VyZSI6dHJ1ZX0=
vmess://eyJ2IjoiMiIsInBzIjoi8J+HpvCfh7cg6Zi/5qC55bu3IiwiYWRkIjoiYXIuamllZGlhbi5zdHJlYW0iLCJwb3J0Ijo0NDMsImlkIjoiMDkyNTI2Y2ItNGU1YS00ODNhLWFkNDYtZTg1YzJhZDkzOTQ4IiwiYWlkIjowLCJzY3kiOiJhdXRvIiwibmV0IjoidGNwIiwidHlwZSI6Im5vbmUiLCJ0bHMiOiJ0bHMiLCJzbmkiOiJndy5hbGljZG4uY29tIiwiYWxsb3dJbnNlY3VyZSI6dHJ1ZX0=
vmess://eyJ2IjoiMiIsInBzIjoi8J+qpyDlrpjnvZEgOiDmgKfku7fmr5TmnLrlnLoubmV0IiwiYWRkIjoiMTguMTQxLjE0Ni41NCIsInBvcnQiOjQ0MywiaWQiOiIwOTI1MjZjYi00ZTVhLTQ4M2EtYWQ0Ni1lODVjMmFkOTM5NDgiLCJhaWQiOjAsInNjeSI6ImF1dG8iLCJuZXQiOiJ0Y3AiLCJ0eXBlIjoibm9uZSIsInRscyI6InRscyIsInNuaSI6Imd3LmFsaWNkbi5jb20iLCJhbGxvd0luc2VjdXJlIjp0cnVlfQ==`;

const parser = new SubscriptionParser();

console.log('\n===== 不启用去重 =====\n');
const nodesWithoutDedupe = parser.parse(testUrls, 'Test', { dedupe: false });
console.log(`总数: ${nodesWithoutDedupe.length}\n`);

// 找出 us.jiedian.stream:443
const usNodes = nodesWithoutDedupe.filter(n => n.server === 'us.jiedian.stream' && n.port === 443);
console.log(`us.jiedian.stream:443 节点数: ${usNodes.length}`);
usNodes.forEach((n, i) => {
    console.log(`  ${i + 1}. ${n.name} (长度: ${n.name.length})`);
});

console.log('\n===== 启用去重 =====\n');
const nodesWithDedupe = parser.parse(testUrls, 'Test', { dedupe: true });
console.log(`总数: ${nodesWithDedupe.length}\n`);

const usNodesAfter = nodesWithDedupe.filter(n => n.server === 'us.jiedian.stream' && n.port === 443);
console.log(`us.jiedian.stream:443 节点数: ${usNodesAfter.length}`);
usNodesAfter.forEach((n, i) => {
    console.log(`  ${i + 1}. ${n.name} (长度: ${n.name.length})`);
});

console.log(`\n去重效果: ${nodesWithoutDedupe.length} → ${nodesWithDedupe.length} (去掉 ${nodesWithoutDedupe.length - nodesWithDedupe.length} 个)\n`);
